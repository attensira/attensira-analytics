{"version":3,"sources":["../src/index.ts"],"sourcesContent":["export const ATTENSIRA_DEFAULT_INGEST_URL =\n  'https://ingest.attensira.com/v1/crawler-logs';\n\nexport type AttensiraOptions = {\n  ingestUrl?: string;\n};\n\nconst sent = new Set<string>();\n\n/**\n * Collects basic page-hit data from the browser and sends it to the\n * Attensira ingest API. Safe to call multiple times; duplicate calls\n * for the same projectId + href are ignored.\n */\nexport function trackPageHit(\n  projectId: string,\n  options: AttensiraOptions = {}\n): Promise<void> {\n  if (!projectId || typeof projectId !== 'string') {\n    return Promise.reject(new Error('projectId is required'));\n  }\n\n  if (typeof window === 'undefined') {\n    return Promise.resolve();\n  }\n\n  const href = window.location.href;\n  const dedupeKey = `${projectId}:${href}`;\n  if (sent.has(dedupeKey)) {\n    return Promise.resolve();\n  }\n  sent.add(dedupeKey);\n\n  const payload = {\n    project_id: projectId,\n    action: 'page_hit',\n    payload: {\n      href,\n      referrer: document.referrer || '',\n      user_agent: navigator.userAgent,\n      locale: navigator.language || '',\n      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || '',\n    },\n  };\n\n  const url = options.ingestUrl || ATTENSIRA_DEFAULT_INGEST_URL;\n\n  return fetch(url, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(payload),\n    keepalive: true,\n  }).then(() => undefined);\n}\n"],"mappings":"AAAO,IAAMA,EACX,+CAMIC,EAAO,IAAI,IAOV,SAASC,EACdC,EACAC,EAA4B,CAAC,EACd,CACf,GAAI,CAACD,GAAa,OAAOA,GAAc,SACrC,OAAO,QAAQ,OAAO,IAAI,MAAM,uBAAuB,CAAC,EAG1D,GAAI,OAAO,QAAW,YACpB,OAAO,QAAQ,QAAQ,EAGzB,IAAME,EAAO,OAAO,SAAS,KACvBC,EAAY,GAAGH,CAAS,IAAIE,CAAI,GACtC,GAAIJ,EAAK,IAAIK,CAAS,EACpB,OAAO,QAAQ,QAAQ,EAEzBL,EAAK,IAAIK,CAAS,EAElB,IAAMC,EAAU,CACd,WAAYJ,EACZ,OAAQ,WACR,QAAS,CACP,KAAAE,EACA,SAAU,SAAS,UAAY,GAC/B,WAAY,UAAU,UACtB,OAAQ,UAAU,UAAY,GAC9B,SAAU,KAAK,eAAe,EAAE,gBAAgB,EAAE,UAAY,EAChE,CACF,EAEMG,EAAMJ,EAAQ,WAAaJ,EAEjC,OAAO,MAAMQ,EAAK,CAChB,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAmB,EAC9C,KAAM,KAAK,UAAUD,CAAO,EAC5B,UAAW,EACb,CAAC,EAAE,KAAK,IAAG,EAAY,CACzB","names":["ATTENSIRA_DEFAULT_INGEST_URL","sent","trackPageHit","projectId","options","href","dedupeKey","payload","url"]}